---
- name: Perform install from repositories
  block:
    - name: apt-get update
      apt:
        update_cache: yes
        cache_valid_time: 3600
      when: ansible_os_family == 'Debian'

    - name: Install java
      package:
        name: '{{ openjdk_package }}'
        state: present
      register: installed_packages
      #until: installed_packages is succeeded

    - name: Find java_folder
      find:
        paths: '{{ openjdk_path }}'
        recurse: False
        file_type: directory
        patterns: '{{ java_folder }}'
        use_regex: True
      register: java_dir

    - name: Set actual java directory
      set_fact:
        java_folder: "{{ java_dir.files | map(attribute='path') | list | last | basename }}"

    - name: test java_folder
      debug:
        var: java_folder

    - name: Put java profile
      template:
        src: java.sh.j2
        dest: /etc/profile.d/java.sh
        owner: root
        group: root
        mode: 0555
  become: True
