---
- name: 'Fetch oracle artifact with {{ transport }} transport'
  include_tasks: '{{ transport_driver }}'
  with_first_found:
    - 'fetch/{{ transport }}.yml'
    - fetch/unknown-transport.yml
  loop_control:
    loop_var: transport_driver

- name: 'Fetch oracle security policy with {{ java_unlimited_policy_transport }} transport'
  include_tasks: '{{ transport_driver }}'
  with_first_found:
    - 'security_policy_fetch/{{ java_unlimited_policy_transport }}.yml'
    - security_policy_fetch/unknown-transport.yml
  loop_control:
    loop_var: transport_driver
  when:
    - java_unlimited_policy_enabled
    - java_full_version is version('8.151', '<')

- name: Perform install from artifacts
  block:
    - name: Set java full version
      set_fact:
        java_full_version: '{{ java_major_version }}.{{ java_minor_version }}'

    - name: Install requirements
      package:
        name: '{{ requirements }}'
        state: present
      register: installed_packages
      until: installed_packages is succeeded

    - name: 'Perform {{ java_binary_type }} install'
      include_tasks: '{{ ansible_system }}/{{ java_binary_type }}.yml'

    - name: Put java profile
      template:
        src: java.sh.j2
        dest: /etc/profile.d/java.sh
        owner: root
        group: root
        mode: 0555
  become: True
